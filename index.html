<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payboss Floor Monitor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.263.1",
        "firebase/app": "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js",
        "firebase/auth": "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js",
        "firebase/firestore": "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"
      }
    }
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @keyframes pulse-slow { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .animate-pulse-slow { animation: pulse-slow 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        .menu-list::-webkit-scrollbar { width: 4px; }
        .menu-list::-webkit-scrollbar-track { background: #f1f1f1; }
        .menu-list::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 2px; }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 font-sans">
    <div id="root"></div>
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            Users, Clock, Coffee, CheckCircle, Trash2, RefreshCw, 
            MapPin, AlertCircle, Database, LogIn, LogOut, Lock, 
            ShieldAlert, Copy, Activity, ArrowRightLeft, Edit3, Calendar, User, CalendarClock, XCircle, FileText, Music, Crown
        } from 'lucide-react';
        
        import { initializeApp } from 'firebase/app';
        import { getFirestore, collection, doc, onSnapshot, updateDoc, writeBatch, getDocs, query, limit } from 'firebase/firestore';
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'firebase/auth';

        const firebaseConfig = {
            apiKey: "AIzaSyB0nHqdAw_dV9pHcQ_cSnWtNsn4CwwwUNc",
            authDomain: "payboss-cafe-system.firebaseapp.com",
            projectId: "payboss-cafe-system",
            storageBucket: "payboss-cafe-system.firebasestorage.app",
            messagingSenderId: "570523503793",
            appId: "1:570523503793:web:0a7ba7ce751eb95a3f6690",
            measurementId: "G-H1NJ369HE9"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const COLLECTION_NAME = 'tables'; 

        const FULL_FIRESTORE_RULES = `rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    function isStaff() { return request.auth != null; }
    match /tables/{tableId} { allow read, write: if isStaff(); }
    match /orders/{orderId} { allow read: if isStaff(); }
  }
}`;

        const App = () => {
            const [user, setUser] = useState(null);
            const [tables, setTables] = useState([]);
            const [selectedTableId, setSelectedTableId] = useState(null);
            const [currentTime, setCurrentTime] = useState(new Date());
            const [loading, setLoading] = useState(true);
            const [errorMsg, setErrorMsg] = useState('');
            const [permissionError, setPermissionError] = useState(false); 
            const [statusLog, setStatusLog] = useState('Siap.');
            const [isSettingUp, setIsSettingUp] = useState(false);
            const [isSyncing, setIsSyncing] = useState(false);
            const [isReserving, setIsReserving] = useState(false);
            const [resName, setResName] = useState('');
            const [resTime, setResTime] = useState('');
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [isLoggingIn, setIsLoggingIn] = useState(false);

            useEffect(() => {
                const unsubscribe = onAuthStateChanged(auth, (u) => {
                    setUser(u);
                    if (u) { setLoading(true); setPermissionError(false); setStatusLog(`Login: ${u.email}`); }
                    else { setLoading(false); setTables([]); setStatusLog("Belum login."); }
                });
                return () => unsubscribe;
            }, []);

            useEffect(() => {
                if (!user) return;
                const unsubscribe = onSnapshot(collection(db, COLLECTION_NAME), (snap) => {
                    const data = snap.docs.map(d => ({ 
                        id: d.id, ...d.data(), 
                        startTime: d.data().startTime?.seconds ? new Date(d.data().startTime.seconds * 1000) : null 
                    }));
                    data.sort((a, b) => {
                        const numA = a.tableNumber || 999;
                        const numB = b.tableNumber || 999;
                        if (numA !== numB) return numA - numB;
                        return a.name.localeCompare(b.name);
                    });
                    setTables(data); setLoading(false); setPermissionError(false);
                }, (err) => {
                    if (err.code === 'permission-denied') { setPermissionError(true); setLoading(false); }
                    else { setErrorMsg(err.message); setLoading(false); }
                });
                return () => unsubscribe();
            }, [user]);

            useEffect(() => {
                const timer = setInterval(() => setCurrentTime(new Date()), 5000);
                return () => clearInterval(timer);
            }, []);

            const handleLogin = async (e) => {
                e.preventDefault(); setIsLoggingIn(true); setErrorMsg('');
                try { await signInWithEmailAndPassword(auth, email, password); } 
                catch (error) { setErrorMsg("Email/Password salah."); setIsLoggingIn(false); }
            };

            const handleLogout = async () => { await signOut(auth); setEmail(''); setPassword(''); };

            const initializeDatabase = async () => {
                if (!user) return; setIsSettingUp(true); setStatusLog("Membuat 33 Meja + Room...");
                try {
                    const batch = writeBatch(db);
                    for (let i = 1; i <= 33; i++) {
                        const tId = `table-${i.toString().padStart(2, '0')}`;
                        let type = 'Indoor';
                        if (i > 10) type = 'Indoor Depan';
                        if (i > 15) type = 'Lantai 2';
                        if (i > 25) type = 'Outdoor Taman';
                        if (i > 30) type = 'Outdoor Belakang';
                        
                        batch.set(doc(db, COLLECTION_NAME, tId), {
                            tableNumber: i, name: `T-${i.toString().padStart(2, '0')}`, type, capacity: 4, status: 'empty', customer: '', startTime: null, total: 0, items: []
                        }, { merge: true });
                    }
                    const specialRooms = [
                        { id: 'table-vip', name: 'VIP Payboss', type: 'VIP Payboss', cap: 8 },
                        { id: 'table-karaoke-1', name: 'Karaoke 1', type: 'Room Karaoke 1', cap: 6 },
                        { id: 'table-karaoke-2', name: 'Karaoke 2', type: 'Room Karaoke 2', cap: 6 },
                        { id: 'table-karaoke-3', name: 'Karaoke 3', type: 'Room Karaoke 3', cap: 6 },
                    ];
                    specialRooms.forEach(room => {
                        batch.set(doc(db, COLLECTION_NAME, room.id), {
                            tableNumber: 100, name: room.name, type: room.type, capacity: room.cap, status: 'empty', customer: '', startTime: null, total: 0, items: []
                        }, { merge: true });
                    });
                    await batch.commit(); alert("Sukses! 33 Meja + VIP + Karaoke berhasil dibuat.");
                } catch (err) { err.code === 'permission-denied' ? setPermissionError(true) : alert(err.message); }
                setIsSettingUp(false);
            };

            const syncFromPOS = async () => {
                if (!user) return; setIsSyncing(true); setStatusLog("Scanning POS...");
                try {
                    const snap = await getDocs(query(collection(db, 'orders'), limit(50)));
                    const batch = writeBatch(db);
                    let count = 0;
                    snap.forEach(d => {
                        const data = d.data();
                        const name = data.customerName || data.name || data.customer || (data.queueNumber ? `Antrian #${data.queueNumber}` : 'Tamu POS');
                        let menuItems = [];
                        if (data.items && Array.isArray(data.items)) menuItems = data.items.map(i => `${i.qty || 1}x ${i.name || i.menuName || 'Item'}`);
                        else if (data.cart && Array.isArray(data.cart)) menuItems = data.cart.map(i => `${i.qty || 1}x ${i.name || i.menuName || 'Item'}`);
                        if (menuItems.length === 0 && (data.itemName || data.productName)) menuItems.push(`1x ${data.itemName || data.productName}`);

                        if (data.status !== 'completed' && data.status !== 'voided' && data.table) {
                            let tId = '';
                            let tableName = data.table.toString();
                            if (!isNaN(tableName) && parseInt(tableName) > 0) tId = `table-${tableName.padStart(2, '0')}`;
                            else {
                                if (tableName.includes('VIP')) tId = 'table-vip';
                                else if (tableName.includes('Karaoke') && tableName.includes('1')) tId = 'table-karaoke-1';
                                else if (tableName.includes('Karaoke') && tableName.includes('2')) tId = 'table-karaoke-2';
                                else if (tableName.includes('Karaoke') && tableName.includes('3')) tId = 'table-karaoke-3';
                                else tId = `table-${tableName.replace(/\s+/g, '-').toLowerCase()}`;
                            }
                            const existing = tables.find(t => t.id === tId);
                            let type = 'Indoor';
                            if (tId.includes('karaoke')) type = 'Room Karaoke';
                            if (tId.includes('vip')) type = 'VIP Payboss';

                            if (!existing || existing.status !== 'occupied') {
                                batch.set(doc(db, COLLECTION_NAME, tId), {
                                    tableNumber: !isNaN(tableName) ? parseInt(tableName) : 100, 
                                    name: tableName.length < 3 ? `T-${tableName.padStart(2, '0')}` : tableName, 
                                    type, capacity: 4, status: 'occupied', customer: name, total: data.total || 0, startTime: new Date(), items: menuItems
                                }, { merge: true });
                                count++;
                            } else {
                                batch.update(doc(db, COLLECTION_NAME, tId), { total: data.total || 0, items: menuItems, customer: name });
                                count++;
                            }
                        }
                    });
                    if (count > 0) await batch.commit();
                    setStatusLog(`Sync: ${count} meja diupdate.`);
                } catch (err) { console.error(err); alert(`Gagal: ${err.message}`); }
                setIsSyncing(false);
            };

            const updateTableStatus = async (id, data) => {
                try { await updateDoc(doc(db, COLLECTION_NAME, id), data); }
                catch (err) { err.code === 'permission-denied' ? setPermissionError(true) : alert(err.message); }
            };

            const formatTime = (d) => d ? d.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' }) : '-';
            const getDuration = (start) => {
                if (!start) return '0m';
                const m = Math.floor((currentTime - start) / 60000);
                return m < 0 ? '0m' : `${Math.floor(m/60)}j ${m%60}m`;
            };

            const getStatusColor = (status) => {
                switch (status) {
                    case 'occupied': return 'bg-red-50 border-red-500 text-red-700 hover:bg-red-100';
                    case 'reserved': return 'bg-purple-50 border-purple-500 text-purple-700 hover:bg-purple-100';
                    case 'empty': return 'bg-green-50 border-green-500 text-green-700 hover:bg-green-100';
                    case 'dirty': return 'bg-yellow-50 border-yellow-500 text-yellow-700 hover:bg-yellow-100';
                    default: return 'bg-gray-50 border-gray-300';
                }
            };

            const getLocationColor = (type) => {
                if(!type) return 'bg-gray-200 text-gray-700';
                const t = type.toLowerCase();
                if (t.includes('karaoke')) return 'bg-rose-100 text-rose-700';
                if (t.includes('vip')) return 'bg-purple-100 text-purple-700';
                if (t.includes('outdoor')) return 'bg-orange-100 text-orange-700';
                if (t.includes('lantai 2')) return 'bg-indigo-100 text-indigo-700';
                if (t.includes('depan')) return 'bg-sky-100 text-sky-700';
                return 'bg-blue-100 text-blue-700';
            };

            const handleCheckIn = (name) => {
                if(!selectedTableId) return;
                updateTableStatus(selectedTableId, { status: 'occupied', customer: name || 'Pelanggan', startTime: new Date(), total: 0, items: [] });
            };
            const handleReservation = () => {
                if(!selectedTableId || !resName || !resTime) return alert("Nama dan Jam wajib diisi!");
                updateTableStatus(selectedTableId, { status: 'reserved', customer: resName, reservationTime: resTime });
                setIsReserving(false); setResName(''); setResTime('');
            };
            const handleArrival = () => { 
                if(!selectedTableId) return;
                updateTableStatus(selectedTableId, { status: 'occupied', startTime: new Date(), reservationTime: null }); 
            };
            const handleCancelRes = () => updateTableStatus(selectedTableId, { status: 'empty', customer: '', reservationTime: null });
            const handleCheckout = () => updateTableStatus(selectedTableId, { status: 'dirty', customer: '', startTime: null, total: 0, items: [] });
            const handleClean = () => updateTableStatus(selectedTableId, { status: 'empty', items: [] });
            const handleCustomerNameUpdate = (e) => {
                if (!selectedTableId) return;
                const newName = e.target.value;
                if (newName && newName !== selectedTable.customer) updateTableStatus(selectedTableId, { customer: newName });
            };

            // --- HELPERS (FIXED) ---
            // Memastikan semua variabel yang dipakai di JSX didefinisikan di sini
            const selectedTable = tables.find(t => t.id === selectedTableId);
            const totalTables = tables.length;
            const occupied = tables.filter(t => t.status === 'occupied').length;
            const reserved = tables.filter(t => t.status === 'reserved').length;
            const occupancyRate = totalTables > 0 ? Math.round((occupied / totalTables) * 100) : 0;

            if (!user) return (
                <div className="min-h-screen bg-slate-100 flex items-center justify-center p-4">
                    <div className="bg-white p-8 rounded-xl shadow-lg w-full max-w-md border">
                        <div className="text-center mb-6"><div className="bg-green-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4"><Lock className="w-8 h-8 text-green-600" /></div><h1 className="text-2xl font-bold">Payboss Login</h1></div>
                        {errorMsg && <div className="bg-red-50 text-red-600 p-3 rounded text-sm mb-4 flex items-center gap-2"><AlertCircle size={16}/>{errorMsg}</div>}
                        <form onSubmit={handleLogin} className="space-y-4">
                            <input type="email" required className="w-full p-3 border rounded" placeholder="Email Staff" value={email} onChange={e=>setEmail(e.target.value)}/>
                            <input type="password" required className="w-full p-3 border rounded" placeholder="Password" value={password} onChange={e=>setPassword(e.target.value)}/>
                            <button disabled={isLoggingIn} className="w-full py-3 bg-green-600 text-white font-bold rounded flex justify-center gap-2">{isLoggingIn?<RefreshCw className="animate-spin"/>:<LogIn/>} Masuk</button>
                        </form>
                    </div>
                </div>
            );

            return (
                <div className="flex h-screen bg-slate-100 font-sans text-slate-800 overflow-hidden">
                    {permissionError && <div className="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4"><div className="bg-white p-6 rounded-xl max-w-md"><h2 className="text-xl font-bold text-red-600 mb-2">Akses Ditolak</h2><p>Cek Rules Firestore.</p><button onClick={()=>navigator.clipboard.writeText(FULL_FIRESTORE_RULES)} className="mt-4 bg-slate-800 text-white px-4 py-2 rounded text-sm">Salin Rules</button></div></div>}

                    <div className="flex-1 flex flex-col overflow-hidden">
                        <header className="bg-white border-b px-6 py-4 flex justify-between items-center shadow-sm z-10">
                            <div><h1 className="text-xl font-bold flex items-center gap-2"><Database className="text-green-600"/> Payboss Floor</h1><p className="text-xs text-slate-500">{user.email}</p></div>
                            <div className="flex gap-3">
                                <button onClick={syncFromPOS} disabled={isSyncing} className={`px-3 py-2 text-white text-xs font-bold rounded flex items-center gap-2 ${isSyncing?'bg-orange-400':'bg-orange-600'}`}>{isSyncing?<RefreshCw className="animate-spin w-3 h-3"/>:<ArrowRightLeft size={14}/>} SCAN ORDERS</button>
                                <button onClick={initializeDatabase} disabled={isSettingUp} className="px-4 py-2 bg-slate-900 text-white text-xs font-bold rounded">SETUP MEJA (RESET)</button>
                                <button onClick={handleLogout} className="px-3 py-2 border border-red-200 text-red-600 rounded text-xs font-bold flex items-center gap-1"><LogOut size={14}/> Keluar</button>
                            </div>
                        </header>

                        <main className="flex-1 overflow-auto p-4 flex flex-col">
                            {loading ? <div className="flex-1 flex items-center justify-center text-slate-400"><RefreshCw className="animate-spin"/></div> :
                            tables.length===0 ? <div className="flex-1 flex items-center justify-center text-slate-400">Database Kosong. Klik Setup Meja (Reset).</div> :
                            <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-3 pb-8">
                                {tables.map(t => (
                                    <button key={t.id} onClick={()=>{setSelectedTableId(t.id); setIsReserving(false);}} className={`relative p-3 rounded-lg border-2 transition-all flex flex-col items-start min-h-[110px] shadow-sm text-left ${selectedTableId===t.id?'ring-2 ring-blue-400 scale-[1.02] z-10':''} ${getStatusColor(t.status)}`}>
                                        <div className="flex justify-between w-full mb-1">
                                            <span className="font-bold text-lg truncate pr-1">{t.name}</span>
                                            {/* POSISI FONT DIPERBESAR */}
                                            <span className={`text-xs font-bold px-2 py-1 rounded truncate max-w-[120px] ${getLocationColor(t.type)}`}>{t.type}</span>
                                        </div>
                                        <div className="text-xs opacity-70 mb-2 flex items-center gap-1"><Users size={10}/> {t.capacity}</div>
                                        {t.status === 'occupied' && <div className="mt-auto w-full"><div className="text-sm font-bold truncate mb-1" title={t.customer}>{t.customer}</div><div className="flex justify-between text-[10px] bg-white/40 p-1 rounded"><span className="flex gap-1"><Clock size={10}/> {getDuration(t.startTime)}</span><span className="font-mono font-bold">{formatTime(t.startTime)}</span></div></div>}
                                        {t.status === 'reserved' && <div className="mt-auto w-full text-purple-900"><div className="text-xs font-bold truncate flex items-center gap-1"><CalendarClock size={12}/> {t.customer}</div><div className="text-[10px] mt-1 bg-white/40 p-1 rounded font-bold text-center">Jam: {t.reservationTime}</div></div>}
                                        {t.status === 'empty' && <div className="mt-auto text-xs opacity-60 flex items-center gap-1"><CheckCircle size={12}/> Kosong</div>}
                                        {t.status === 'dirty' && <div className="mt-auto text-xs font-bold flex items-center gap-1 animate-pulse text-yellow-800"><Trash2 size={12}/> Kotor</div>}
                                    </button>
                                ))}
                            </div>}
                            <div className="mt-auto pt-2 border-t text-[10px] font-mono text-slate-400 flex justify-between">
                                <div className="flex items-center gap-2"><Activity size={10}/> {statusLog}</div>
                                <span>Total: {totalTables} | Terisi: {occupied} | Reservasi: {reserved}</span>
                            </div>
                        </main>
                    </div>

                    <aside className="w-80 bg-white border-l shadow-2xl flex flex-col z-20 shrink-0">
                        {selectedTable ? (
                        <>
                            <div className="p-5 border-b bg-slate-50">
                                <div className="mb-4 flex items-center justify-between">
                                    <div className="overflow-hidden"><label className="text-[10px] font-bold text-slate-400 uppercase">Meja</label><div className="text-2xl font-bold text-slate-800 truncate">{selectedTable.name}</div></div>
                                    <div className={`px-2 py-1 rounded text-xs font-bold uppercase border ${getStatusColor(selectedTable.status)} shrink-0 ml-2`}>{selectedTable.status === 'reserved' ? 'Reservasi' : selectedTable.status}</div>
                                </div>
                                <div className="grid grid-cols-2 gap-3">
                                    <div><label className="text-[10px] text-slate-400 uppercase">Kapasitas</label><input type="number" defaultValue={selectedTable.capacity} onBlur={(e)=>updateTableStatus(selectedTableId, {capacity: parseInt(e.target.value)})} className="w-full p-1 text-sm border rounded"/></div>
                                    <div>
                                        <label className="text-[10px] text-slate-400 uppercase">Posisi</label>
                                        <select value={selectedTable.type} onChange={(e)=>updateTableStatus(selectedTableId, {type: e.target.value})} className="w-full p-1 text-sm border rounded cursor-pointer">
                                            <option value="Indoor">Indoor</option>
                                            <option value="Indoor Depan">Indoor Depan</option>
                                            <option value="Outdoor">Outdoor</option>
                                            <option value="Outdoor Taman">Outdoor Taman</option>
                                            <option value="Outdoor Belakang">Outdoor Belakang</option>
                                            <option value="Lantai 2">Lantai 2</option>
                                            <option value="VIP Utama">VIP Utama</option>
                                            <option value="VIP Payboss">VIP Payboss</option>
                                            <option value="Room Meeting 1">Room Meeting 1</option>
                                            <option value="Room Meeting 2">Room Meeting 2</option>
                                            <option value="Room Karaoke 1">Room Karaoke 1</option>
                                            <option value="Room Karaoke 2">Room Karaoke 2</option>
                                            <option value="Room Karaoke 3">Room Karaoke 3</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div className="flex-1 p-5 overflow-y-auto">
                                {selectedTable.status === 'occupied' && (
                                    <div className="space-y-4">
                                        <div className="bg-blue-50 p-4 rounded border border-blue-100">
                                            <div className="group">
                                                <label className="text-xs font-bold text-blue-400 uppercase flex items-center gap-1">Pelanggan <Edit3 size={10} className="opacity-50"/></label>
                                                <input key={`cust-${selectedTable.id}`} type="text" defaultValue={selectedTable.customer} onBlur={handleCustomerNameUpdate} onKeyDown={(e) => { if(e.key === 'Enter') e.target.blur(); }} className="text-lg font-bold text-slate-800 w-full bg-transparent border-b border-transparent hover:border-blue-200 focus:border-blue-500 focus:outline-none transition-colors" placeholder="Nama Pelanggan"/>
                                            </div>
                                            <div className="mt-2 pt-2 border-t border-blue-200 grid grid-cols-2 gap-2 text-sm">
                                                <div><span className="text-[10px] text-slate-500 block">Masuk</span><b>{formatTime(selectedTable.startTime)}</b></div>
                                                <div><span className="text-[10px] text-slate-500 block">Durasi</span><b className="text-blue-600">{getDuration(selectedTable.startTime)}</b></div>
                                            </div>
                                        </div>
                                        <div className="flex flex-col h-full">
                                            <div className="flex items-center gap-2 mb-2"><FileText size={16} className="text-slate-400"/><label className="text-xs font-bold text-slate-500 uppercase">Daftar Menu</label></div>
                                            <div className="bg-white border border-slate-200 rounded-lg p-3 max-h-48 overflow-y-auto shadow-sm menu-list">
                                                {selectedTable.items && selectedTable.items.length > 0 ? (
                                                    <ul className="text-sm space-y-2">{selectedTable.items.map((item, idx) => (<li key={idx} className="border-b border-slate-100 last:border-0 pb-1 last:pb-0 text-slate-700 flex items-start"><span className="w-1.5 h-1.5 rounded-full bg-slate-300 mt-1.5 mr-2 shrink-0"></span>{item}</li>))}</ul>
                                                ) : <div className="text-center py-4 text-slate-400 italic text-xs">Belum ada menu yang di-scan dari POS.</div>}
                                            </div>
                                            <div className="mt-3 flex justify-between items-center border-t pt-3"><span className="text-sm font-semibold text-slate-500">Total Tagihan</span><span className="font-mono text-lg font-bold text-slate-800">Rp {(selectedTable.total||0).toLocaleString()}</span></div>
                                        </div>
                                    </div>
                                )}
                                {selectedTable.status === 'reserved' && (
                                    <div className="bg-purple-50 p-4 rounded border border-purple-200 text-purple-900">
                                        <div className="flex items-center gap-2 mb-2"><CalendarClock size={20}/><span className="font-bold text-lg">Data Reservasi</span></div>
                                        <div className="space-y-2 text-sm">
                                            <div className="border-b border-purple-200 pb-1"><span className="text-xs opacity-70 block">Atas Nama:</span><input key={`res-${selectedTable.id}`} type="text" defaultValue={selectedTable.customer} onBlur={handleCustomerNameUpdate} onKeyDown={(e) => { if(e.key === 'Enter') e.target.blur(); }} className="font-bold w-full bg-transparent border-b border-transparent hover:border-purple-300 focus:border-purple-500 focus:outline-none transition-colors text-purple-900"/></div>
                                            <div className="flex justify-between border-b border-purple-200 pb-1"><span>Jam:</span><b>{selectedTable.reservationTime}</b></div>
                                        </div>
                                    </div>
                                )}
                                {selectedTable.status === 'empty' && !isReserving && <div className="text-center py-8 opacity-60"><Coffee size={40} className="mx-auto mb-2"/><p className="text-sm">Meja Kosong.</p></div>}
                                {isReserving && selectedTable.status === 'empty' && (
                                    <div className="bg-white p-4 rounded border border-purple-200 shadow-sm animate-pulse-slow">
                                        <h3 className="font-bold text-purple-700 mb-3 flex items-center gap-2"><Edit3 size={14}/> Form Reservasi</h3>
                                        <div className="space-y-3">
                                            <div><label className="text-xs font-bold text-slate-500">Nama Pemesan</label><input autoFocus type="text" value={resName} onChange={e=>setResName(e.target.value)} className="w-full p-2 border rounded focus:ring-2 ring-purple-200 outline-none" placeholder="Contoh: Pak Budi"/></div>
                                            <div><label className="text-xs font-bold text-slate-500">Jam Kedatangan</label><input type="time" value={resTime} onChange={e=>setResTime(e.target.value)} className="w-full p-2 border rounded focus:ring-2 ring-purple-200 outline-none"/></div>
                                            <div className="flex gap-2 mt-2"><button onClick={()=>setIsReserving(false)} className="flex-1 py-2 text-xs bg-slate-200 rounded hover:bg-slate-300">Batal</button><button onClick={handleReservation} className="flex-1 py-2 text-xs bg-purple-600 text-white rounded hover:bg-purple-700 font-bold">Simpan</button></div>
                                        </div>
                                    </div>
                                )}
                            </div>

                            <div className="p-5 border-t bg-slate-50 space-y-2">
                                {selectedTable.status === 'empty' && !isReserving && <><button onClick={()=>handleCheckIn(prompt('Nama Pelanggan:'))} className="w-full py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded shadow flex justify-center gap-2"><CheckCircle size={18}/> Check-In Sekarang</button><button onClick={()=>setIsReserving(true)} className="w-full py-3 bg-purple-100 hover:bg-purple-200 text-purple-700 font-bold rounded shadow flex justify-center gap-2"><CalendarClock size={18}/> Buat Reservasi</button></>}
                                {selectedTable.status === 'reserved' && <><button onClick={handleArrival} className="w-full py-3 bg-green-600 hover:bg-green-700 text-white font-bold rounded shadow flex justify-center gap-2"><User size={18}/> Tamu Datang (Check-In)</button><button onClick={handleCancelRes} className="w-full py-2 bg-red-100 hover:bg-red-200 text-red-600 font-bold rounded flex justify-center gap-2"><XCircle size={18}/> Batal Reservasi</button></>}
                                {selectedTable.status === 'occupied' && <button onClick={handleCheckout} className="w-full py-3 bg-red-600 text-white font-bold rounded shadow">Checkout / Bayar</button>}
                                {selectedTable.status === 'dirty' && <button onClick={handleClean} className="w-full py-3 bg-green-600 text-white font-bold rounded shadow">Meja Sudah Bersih</button>}
                            </div>
                        </>
                        ) : <div className="flex-1 flex items-center justify-center text-slate-400 p-8 text-center"><Database size={32} className="mb-2 opacity-50"/><p>Pilih meja.</p></div>}
                    </aside>
                </div>
            );
        };
        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
